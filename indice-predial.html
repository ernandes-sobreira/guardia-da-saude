<!doctype html>
<html lang="pt-br">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Protocolo Predial (Avan√ßado) | Vigil√¢ncia Entomol√≥gica</title>
<meta name="theme-color" content="#db2777"/>

<style>
:root{
  --bg0:#fff7fb;
  --bg1:#ffe4f2;
  --card: rgba(255,255,255,.92);
  --stroke: rgba(140,20,90,.18);
  --txt:#3b0a2a;
  --muted: rgba(59,10,42,.65);
  --pink:#db2777;
  --violet:#8b5cf6;
  --teal:#06b6d4;
  --green:#22c55e;
  --gold:#f59e0b;
  --red:#ef4444;
  --r:18px;
  --shadow: 0 18px 60px rgba(120,20,80,.18);
  font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial;
}
*{box-sizing:border-box}
body{
  margin:0;
  background:
    radial-gradient(900px 600px at 10% 0%, rgba(219,39,119,.18), transparent 55%),
    radial-gradient(800px 600px at 90% 10%, rgba(139,92,246,.18), transparent 55%),
    linear-gradient(180deg,var(--bg0),var(--bg1));
  color:var(--txt);
}
header{
  position:sticky; top:0; z-index:20;
  background: rgba(255,247,251,.9);
  backdrop-filter: blur(10px);
  border-bottom:1px solid var(--stroke);
}
.h{
  max-width:980px;
  margin:auto;
  padding:14px 16px;
  display:flex;
  gap:12px;
  align-items:center;
}
.badge{
  width:44px;height:44px;border-radius:16px;
  display:grid;place-items:center;
  background:linear-gradient(135deg,var(--pink),var(--violet));
  color:#fff;
  box-shadow:var(--shadow);
  font-size:20px;
}
.h h1{margin:0;font-size:16px}
.h p{margin:2px 0 0;font-size:12px;color:var(--muted)}

main{
  max-width:980px;
  margin:auto;
  padding:16px 16px 130px;
  display:grid;
  grid-template-columns: 1fr;
  gap:14px;
}

.panel{
  background:var(--card);
  border:1px solid var(--stroke);
  border-radius:var(--r);
  box-shadow:var(--shadow);
  overflow:hidden;
}
.ph{
  padding:14px;
  border-bottom:1px solid var(--stroke);
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  flex-wrap:wrap;
}
.ph h2{margin:0;font-size:14px}
.ph small{color:var(--muted)}
.pb{padding:14px}

.grid2{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:12px;
}
@media(max-width:780px){
  .grid2{grid-template-columns:1fr}
}

label{display:block;font-weight:800;font-size:12px}
input,select,textarea{
  width:100%;
  border:1px solid var(--stroke);
  border-radius:14px;
  padding:10px;
  margin-top:6px;
  background:#fff;
  color:var(--txt);
}
textarea{min-height:140px}

.row{
  display:grid;
  grid-template-columns: 22px 1fr auto;
  gap:10px;
  align-items:center;
  padding:10px;
  border:1px solid rgba(140,20,90,.12);
  border-radius:14px;
  background:rgba(255,255,255,.65);
  margin-bottom:10px;
}
.row input[type="checkbox"]{
  width:18px;height:18px;
}
.row .meta{
  font-size:12px;
  color:var(--muted);
}
.qty{
  display:flex; align-items:center; gap:6px;
}
.qty input{
  width:90px;
  padding:8px 10px;
  border-radius:12px;
  margin:0;
}

.pills{
  display:flex; flex-wrap:wrap; gap:8px;
}
.pill{
  display:inline-flex; align-items:center; gap:8px;
  padding:10px 12px;
  border-radius:999px;
  border:1px solid rgba(140,20,90,.14);
  background:rgba(255,255,255,.65);
}
.pill select{
  width:auto;
  padding:8px 10px;
  margin:0;
  border-radius:999px;
}

.actions{
  display:flex; gap:10px; flex-wrap:wrap;
}
.btn{
  border:none;
  border-radius:16px;
  padding:12px 14px;
  font-weight:900;
  cursor:pointer;
}
.btn.primary{
  background:linear-gradient(135deg,var(--pink),var(--violet));
  color:white;
}
.btn.ghost{
  background:rgba(255,255,255,.75);
  border:1px solid var(--stroke);
  color:var(--txt);
}
.btn.warn{
  background:rgba(245,158,11,.15);
  border:1px solid rgba(245,158,11,.35);
}
.btn.danger{
  background:rgba(239,68,68,.12);
  border:1px solid rgba(239,68,68,.35);
}
.result{
  padding:14px;
  border-left:4px solid var(--pink);
  background:rgba(219,39,119,.06);
  border-radius:16px;
  margin-top:12px;
}
.kpis{
  display:grid;
  grid-template-columns: repeat(3,1fr);
  gap:10px;
  margin-top:10px;
}
@media(max-width:780px){.kpis{grid-template-columns:1fr}}
.kpi{
  background:rgba(255,255,255,.7);
  border:1px solid rgba(140,20,90,.12);
  border-radius:16px;
  padding:10px;
}
.kpi b{display:block;font-size:12px;color:var(--muted)}
.kpi span{font-size:18px;font-weight:950}

hr{
  border:none;
  border-top:1px solid rgba(140,20,90,.12);
  margin:14px 0;
}

footer{
  position:fixed;
  bottom:0; left:0; right:0;
  background: rgba(255,247,251,.95);
  border-top:1px solid var(--stroke);
}
.foot{
  max-width:980px;
  margin:auto;
  padding:10px;
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}
.foot a{
  flex:1;
  text-align:center;
  text-decoration:none;
  padding:12px;
  border-radius:16px;
  font-weight:900;
  background:rgba(255,255,255,.75);
  border:1px solid rgba(140,20,90,.14);
  color:var(--txt);
}
.foot a.active{
  background:linear-gradient(135deg,var(--pink),var(--violet));
  color:#fff;
  border:none;
}
</style>
</head>

<body>

<header>
  <div class="h">
    <div class="badge">üè¢</div>
    <div>
      <h1>Protocolo Predial (Avan√ßado)</h1>
      <p>√çndices oficiais (IP/IB/IR) + caracteriza√ß√£o de recipientes, fase do vetor, t√©cnicas e relat√≥rio completo</p>
    </div>
  </div>
</header>

<main>

<!-- IDENTIFICA√á√ÉO -->
<section class="panel">
  <div class="ph">
    <h2>1) Identifica√ß√£o do local</h2>
    <small>Preencha antes de calcular</small>
  </div>
  <div class="pb grid2">
    <div>
      <label>Local / pr√©dio</label>
      <input id="local" placeholder="Ex: Escola X ‚Äî Bloco A">
    </div>
    <div>
      <label>Tipo de local</label>
      <select id="tipoLocal">
        <option value="Escolar">Escolar</option>
        <option value="Domiciliar">Domiciliar</option>
        <option value="Comercial">Comercial</option>
        <option value="Institucional">Institucional</option>
        <option value="√Årea comum">√Årea comum</option>
      </select>
    </div>
    <div>
      <label>Data</label>
      <input type="date" id="data">
    </div>
    <div>
      <label>Equipe / alunas (opcional)</label>
      <input id="equipe" placeholder="Ex: Grupo 1 ‚Äî Guardi√£s">
    </div>
  </div>
</section>

<!-- UNIDADES E √çNDICES -->
<section class="panel">
  <div class="ph">
    <h2>2) Unidades e √≠ndices (base oficial)</h2>
    <small>IP (HI), IB (BI) e IR (CI)</small>
  </div>
  <div class="pb grid2">
    <div>
      <label>N¬∫ total de unidades/im√≥veis avaliados</label>
      <input id="imoveis" type="number" min="1" placeholder="Ex: 12">
    </div>
    <div>
      <label>N¬∫ de unidades com evid√™ncia de vetor (larva/pupa/adulto)</label>
      <input id="imoveisPos" type="number" min="0" placeholder="Ex: 2">
    </div>

    <div style="grid-column:1/-1">
      <label>Fase do vetor observada (intensidade)</label>
      <div class="pills">
        <div class="pill">
          üêõ Larvas
          <select id="faseLarva">
            <option value="0">0 (n√£o)</option>
            <option value="1">1 (poucas)</option>
            <option value="2">2 (muitas)</option>
          </select>
        </div>
        <div class="pill">
          üü§ Pupas
          <select id="fasePupa">
            <option value="0">0 (n√£o)</option>
            <option value="1">1 (poucas)</option>
            <option value="2">2 (muitas)</option>
          </select>
        </div>
        <div class="pill">
          ü¶ü Adultos
          <select id="faseAdulto">
            <option value="0">0 (n√£o)</option>
            <option value="1">1 (poucos)</option>
            <option value="2">2 (muitos)</option>
          </select>
        </div>
      </div>
      <div class="meta" style="margin-top:8px">
        Dica: pupas e muitos adultos sugerem risco maior porque indicam emerg√™ncia/atividade recente.
      </div>
    </div>
  </div>
</section>

<!-- RECIPIENTES COM QUANTIDADE -->
<section class="panel">
  <div class="ph">
    <h2>3) Recipientes (marcar + contar)</h2>
    <small>O relat√≥rio vai usar isso</small>
  </div>
  <div class="pb">
    <div class="row">
      <input type="checkbox" id="c_baldes">
      <div>
        <b>Baldes / ton√©is / caixas destampadas</b>
        <div class="meta">Alta prioridade (√°gua armazenada)</div>
      </div>
      <div class="qty">
        <span class="meta">Qtd</span>
        <input type="number" min="0" id="q_baldes" value="0">
      </div>
    </div>

    <div class="row">
      <input type="checkbox" id="c_pratos">
      <div>
        <b>Pratos de plantas / vasos</b>
        <div class="meta">Foco dom√©stico frequente</div>
      </div>
      <div class="qty">
        <span class="meta">Qtd</span>
        <input type="number" min="0" id="q_pratos" value="0">
      </div>
    </div>

    <div class="row">
      <input type="checkbox" id="c_pneus">
      <div>
        <b>Pneus</b>
        <div class="meta">Acumula √°gua + sombra = risco alto</div>
      </div>
      <div class="qty">
        <span class="meta">Qtd</span>
        <input type="number" min="0" id="q_pneus" value="0">
      </div>
    </div>

    <div class="row">
      <input type="checkbox" id="c_calhas">
      <div>
        <b>Calhas / ralos / lajes</b>
        <div class="meta">Dif√≠cil de ver ‚Äî risco ‚Äúinvis√≠vel‚Äù</div>
      </div>
      <div class="qty">
        <span class="meta">Qtd</span>
        <input type="number" min="0" id="q_calhas" value="0">
      </div>
    </div>

    <div class="row">
      <input type="checkbox" id="c_descartaveis">
      <div>
        <b>Materiais descart√°veis (copos, garrafas, sucata)</b>
        <div class="meta">Relaciona-se a manejo de res√≠duos</div>
      </div>
      <div class="qty">
        <span class="meta">Qtd</span>
        <input type="number" min="0" id="q_descartaveis" value="0">
      </div>
    </div>

    <div class="row">
      <input type="checkbox" id="c_naturais">
      <div>
        <b>Recipientes naturais (ocos, brom√©lias)</b>
        <div class="meta">Nem sempre elimin√°vel ‚Äî pode ser monitoramento</div>
      </div>
      <div class="qty">
        <span class="meta">Qtd</span>
        <input type="number" min="0" id="q_naturais" value="0">
      </div>
    </div>

    <div class="grid2" style="margin-top:10px">
      <div>
        <label>Total de recipientes inspecionados</label>
        <input id="recipTotal" type="number" min="0" placeholder="Ex: 28">
      </div>
      <div>
        <label>N¬∫ de recipientes positivos (larva/pupa)</label>
        <input id="recipPos" type="number" min="0" placeholder="Ex: 3">
      </div>
    </div>
  </div>
</section>

<!-- AMBIENTE -->
<section class="panel">
  <div class="ph">
    <h2>4) Caracteriza√ß√£o ambiental (checklist)</h2>
    <small>Risco depende do contexto</small>
  </div>
  <div class="pb">
    <div class="row">
      <input type="checkbox" id="a_sombra">
      <div><b>√Årea sombreada</b><div class="meta">Sombra favorece perman√™ncia de √°gua e atividade do vetor</div></div>
      <div class="meta">+ risco</div>
    </div>
    <div class="row">
      <input type="checkbox" id="a_fluxo">
      <div><b>Pr√≥ximo √† circula√ß√£o humana</b><div class="meta">Aumenta chance de contato humano‚Äìvetor</div></div>
      <div class="meta">+ risco</div>
    </div>
    <div class="row">
      <input type="checkbox" id="a_mo">
      <div><b>Ac√∫mulo de mat√©ria org√¢nica</b><div class="meta">Pode indicar micro-h√°bitats para outros vetores</div></div>
      <div class="meta">+ risco</div>
    </div>
    <div class="row">
      <input type="checkbox" id="a_agua_art">
      <div><b>Presen√ßa de √°gua parada artificial</b><div class="meta">Indicador forte para arboviroses urbanas</div></div>
      <div class="meta">++ risco</div>
    </div>
    <div class="row">
      <input type="checkbox" id="a_agua_nat">
      <div><b>Presen√ßa de √°gua natural</b><div class="meta">Nem sempre elimin√°vel; √†s vezes √© monitoramento</div></div>
      <div class="meta">monitor</div>
    </div>
  </div>
</section>

<!-- T√âCNICAS / ARMADILHAS -->
<section class="panel">
  <div class="ph">
    <h2>5) T√©cnicas e esfor√ßo amostral</h2>
    <small>O relat√≥rio usa isso</small>
  </div>
  <div class="pb grid2">
    <div>
      <label>T√©cnica principal</label>
      <select id="tecPrincipal">
        <option>Inspe√ß√£o visual direta</option>
        <option>Ovitrampa (ovos)</option>
        <option>Armadilha CDC (adultos)</option>
        <option>Busca ativa supervisionada</option>
      </select>
    </div>
    <div>
      <label>Tempo aproximado de inspe√ß√£o (min)</label>
      <input id="tempo" type="number" min="0" placeholder="Ex: 45">
    </div>
    <div>
      <label>N¬∫ de ovitrampas instaladas (se aplic√°vel)</label>
      <input id="nOvi" type="number" min="0" value="0">
    </div>
    <div>
      <label>N¬∫ de CDC instaladas (se aplic√°vel)</label>
      <input id="nCDC" type="number" min="0" value="0">
    </div>
  </div>
</section>

<!-- OBSERVA√á√ïES -->
<section class="panel">
  <div class="ph">
    <h2>6) Observa√ß√µes t√©cnicas</h2>
    <small>Use linguagem de vigil√¢ncia</small>
  </div>
  <div class="pb">
    <textarea id="obs" placeholder="Descreva o padr√£o observado (recipientes dominantes, fase do vetor, condi√ß√µes ambientais, e a√ß√µes recomendadas)."></textarea>
  </div>
</section>

<!-- A√á√ïES -->
<section class="panel">
  <div class="ph">
    <h2>7) Relat√≥rio autom√°tico</h2>
    <small>Gera texto com base no que voc√™ marcou</small>
  </div>
  <div class="pb">
    <div class="actions">
      <button class="btn primary" onclick="gerarRelatorio()">üìÑ Gerar relat√≥rio</button>
      <button class="btn ghost" onclick="copiarRelatorio()">üìã Copiar</button>
      <button class="btn ghost" onclick="baixarRelatorio()">‚¨áÔ∏è Baixar .txt</button>
      <button class="btn warn" onclick="salvarVistoria()">üíæ Salvar vistoria</button>
      <button class="btn danger" onclick="limparTudo()">üßπ Limpar</button>
    </div>

    <div id="saida"></div>

    <hr>

    <div>
      <label>Vistorias salvas neste celular</label>
      <select id="listaVistorias" onchange="carregarVistoria(this.value)">
        <option value="">‚Äî selecionar ‚Äî</option>
      </select>
      <div class="meta" style="margin-top:8px">
        Dica: use isso para avaliar v√°rios pr√©dios e guardar hist√≥rico.
      </div>
    </div>
  </div>
</section>

</main>

<footer>
  <div class="foot">
    <a href="index.html">üè† In√≠cio</a>
    <a href="teoria.html">üß† Teoria</a>
    <a href="campo.html">üå± Campo</a>
    <a class="active" href="indice-predial.html">üè¢ Protocolo</a>
    <a href="laboratorio.html">üß¨ Lab</a>
    <a href="roteiro-professor.html">üë©‚Äçüè´ Prof</a>
  </div>
</footer>

<script>
/* ========= helpers ========= */
function valNum(id){ return Number(document.getElementById(id).value || 0); }
function valStr(id){ return (document.getElementById(id).value || "").trim(); }
function ck(id){ return document.getElementById(id).checked; }
function sel(id){ return document.getElementById(id).value; }

function recipItem(idC, idQ, nome){
  return { checked: ck(idC), qtd: valNum(idQ), nome };
}
function fmtList(arr){
  if(arr.length===0) return "‚Äî";
  return arr.map(x=>`‚Ä¢ ${x}`).join("\n");
}
function todayFallback(){
  const d = new Date();
  const yyyy=d.getFullYear(), mm=String(d.getMonth()+1).padStart(2,'0'), dd=String(d.getDate()).padStart(2,'0');
  return `${yyyy}-${mm}-${dd}`;
}

/* ========= relat√≥rio ========= */
let lastReportText = "";

function gerarRelatorio(){
  const local = valStr("local") || "Local n√£o informado";
  const tipoLocal = sel("tipoLocal");
  const data = document.getElementById("data").value || todayFallback();
  const equipe = valStr("equipe");

  const im = valNum("imoveis");
  const imPos = valNum("imoveisPos");
  if(im<=0){
    alert("Informe o N¬∫ total de unidades/im√≥veis avaliados.");
    return;
  }
  if(imPos>im){
    alert("Im√≥veis positivos n√£o pode ser maior que o total de im√≥veis.");
    return;
  }

  const recipTotal = valNum("recipTotal");
  const recipPos = valNum("recipPos");
  if(recipTotal>0 && recipPos>recipTotal){
    alert("Recipientes positivos n√£o pode ser maior que recipientes inspecionados.");
    return;
  }

  // √≠ndices oficiais
  const IP = ((imPos/im)*100);
  const IB = ((recipPos/im)*100);
  const IR = (recipTotal>0 ? ((recipPos/recipTotal)*100) : 0);

  // itens de recipientes
  const recipItens = [
    recipItem("c_baldes","q_baldes","Baldes/ton√©is/caixas destampadas"),
    recipItem("c_pratos","q_pratos","Pratos de plantas/vasos"),
    recipItem("c_pneus","q_pneus","Pneus"),
    recipItem("c_calhas","q_calhas","Calhas/ralos/lajes"),
    recipItem("c_descartaveis","q_descartaveis","Materiais descart√°veis/sucata"),
    recipItem("c_naturais","q_naturais","Recipientes naturais (ocos/brom√©lias)")
  ];

  const recipMarcados = recipItens
    .filter(x=>x.checked || x.qtd>0)
    .map(x=>`${x.nome}${x.qtd>0?` (qtd: ${x.qtd})`:``}`);

  // ambiente
  const ambMarcados = [];
  if(ck("a_sombra")) ambMarcados.push("√Årea sombreada");
  if(ck("a_fluxo")) ambMarcados.push("Pr√≥ximo √† circula√ß√£o humana");
  if(ck("a_mo")) ambMarcados.push("Ac√∫mulo de mat√©ria org√¢nica");
  if(ck("a_agua_art")) ambMarcados.push("Presen√ßa de √°gua parada artificial");
  if(ck("a_agua_nat")) ambMarcados.push("Presen√ßa de √°gua natural");

  // fase
  const lar = Number(sel("faseLarva"));
  const pup = Number(sel("fasePupa"));
  const adu = Number(sel("faseAdulto"));

  // t√©cnicas / esfor√ßo
  const tec = sel("tecPrincipal");
  const tempo = valNum("tempo");
  const nOvi = valNum("nOvi");
  const nCDC = valNum("nCDC");

  // risco: score transparente (n√£o ‚Äúchute‚Äù)
  // Baseia-se em: positivos (IP/recipPos), fase (pupa/adulto pesa), √°gua artificial e proximidade humana, recipientes de alto risco, esfor√ßo baixo.
  let score = 0;

  // evid√™ncia direta
  score += (imPos>0 ? 3 : 0);
  score += (recipPos>0 ? 3 : 0);

  // fase (pupa/adulto = mais risco)
  score += lar;          // 0-2
  score += pup * 2;      // 0-4
  score += adu * 2;      // 0-4

  // ambiente
  if(ck("a_agua_art")) score += 3;
  if(ck("a_fluxo")) score += 2;
  if(ck("a_sombra")) score += 1;
  if(ck("a_mo")) score += 1;
  // √°gua natural: n√£o soma risco automaticamente (pode ser monitoramento), mas registra

  // recipientes ‚Äúpesados‚Äù
  const qPneus = valNum("q_pneus");
  const qBaldes = valNum("q_baldes");
  const qCalhas = valNum("q_calhas");
  if(ck("c_pneus") || qPneus>0) score += 2;
  if(ck("c_baldes") || qBaldes>0) score += 2;
  if(ck("c_calhas") || qCalhas>0) score += 1;

  // esfor√ßo muito baixo pode reduzir confian√ßa (n√£o ‚Äúreduz risco‚Äù, reduz certeza)
  let confianca = "Alta";
  if(tempo>0 && tempo<20) confianca = "M√©dia";
  if(tempo>0 && tempo<10) confianca = "Baixa";

  // Classifica√ß√£o final (score)
  let classe = "Baixo";
  let cor = "var(--green)";
  if(score>=8){ classe="Moderado"; cor="var(--gold)"; }
  if(score>=13){ classe="Alto"; cor="var(--red)"; }

  // recomenda√ß√µes autom√°ticas
  const acoes = [];
  if(ck("a_agua_art") || recipMarcados.length>0){
    acoes.push("Manejo ambiental imediato: elimina√ß√£o/veda√ß√£o de √°gua parada em recipientes e revis√£o de armazenamento de √°gua.");
  }
  if(ck("c_calhas") || qCalhas>0){
    acoes.push("A√ß√£o espec√≠fica: inspe√ß√£o e limpeza de calhas/ralos/lajes (foco frequentemente oculto).");
  }
  if(ck("c_pneus") || qPneus>0){
    acoes.push("A√ß√£o espec√≠fica: destina√ß√£o adequada de pneus (armazenar coberto/perfurar/encaminhar).");
  }
  if(adu>0){
    acoes.push("Alerta: presen√ßa de adultos sugere atividade recente; refor√ßar orienta√ß√£o e monitoramento em curto prazo.");
  }
  if(pup>0){
    acoes.push("Alerta cr√≠tico: pupas indicam emerg√™ncia pr√≥xima; priorizar interven√ß√£o no mesmo dia.");
  }
  if(nOvi>0){
    acoes.push("Registrar ovitrampas: planejar retorno para leitura/coleta conforme protocolo local (monitoramento).");
  }
  if(nCDC>0){
    acoes.push("Registrar CDC: planejar triagem de adultos no laborat√≥rio e an√°lise do contexto noturno.");
  }
  if(acoes.length===0){
    acoes.push("Manter vigil√¢ncia peri√≥dica e educa√ß√£o em sa√∫de, com reavalia√ß√£o programada.");
  }

  const obs = valStr("obs");

  /