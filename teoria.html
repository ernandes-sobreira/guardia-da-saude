<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>Guardi√£s da Vigil√¢ncia ü¶ã | M√≥dulo 1 ‚Äî Teoria</title>
  <meta name="theme-color" content="#d946ef"/>

  <style>
    :root{
      /* Paleta "feminina guerreira" */
      --bg0:#fff6fb;
      --bg1:#ffe4f3;
      --card: rgba(255,255,255,.78);
      --stroke: rgba(79, 12, 55, .12);

      --txt:#2a0f22;
      --muted: rgba(42,15,34,.68);
      --muted2: rgba(42,15,34,.52);

      --magenta:#d946ef;
      --pink:#fb7185;
      --gold:#f59e0b;
      --lilac:#8b5cf6;
      --teal:#06b6d4;
      --green:#22c55e;
      --danger:#ef4444;

      --shadow: 0 18px 70px rgba(80, 10, 55, .18);
      --r:18px; --r2:24px;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:var(--sans); color:var(--txt);
      background:
        radial-gradient(1200px 700px at 15% 0%, rgba(217,70,239,.18), transparent 60%),
        radial-gradient(900px 650px at 95% 10%, rgba(251,113,133,.18), transparent 58%),
        radial-gradient(900px 700px at 60% 100%, rgba(6,182,212,.14), transparent 55%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
    }

    a{color:inherit}
    .wrap{max-width:1100px;margin:0 auto;padding:16px 16px calc(98px + env(safe-area-inset-bottom));}

    /* Header */
    .top{
      position:sticky; top:0; z-index:40;
      backdrop-filter: blur(10px);
      background: linear-gradient(180deg, rgba(255,246,251,.86), rgba(255,246,251,.60));
      border-bottom:1px solid var(--stroke);
    }
    .topin{
      max-width:1100px;margin:0 auto;padding:12px 16px;
      display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap;
    }
    .brand{display:flex; gap:12px; align-items:center}
    .logo{
      width:44px;height:44px;border-radius:18px;
      border:1px solid var(--stroke);
      box-shadow:var(--shadow);
      background: linear-gradient(135deg, rgba(217,70,239,.92), rgba(251,113,133,.85));
      display:grid; place-items:center;
      font-size:20px;
    }
    .titlebox h1{margin:0;font-size:16px; letter-spacing:.2px}
    .titlebox p{margin:2px 0 0;color:var(--muted); font-size:12px; line-height:1.35}

    .pill{
      display:inline-flex; gap:8px; align-items:center;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.65);
      color: rgba(42,15,34,.75);
      font-size:12px;
      box-shadow: 0 10px 40px rgba(80,10,55,.08);
    }

    .btn{
      cursor:pointer; user-select:none;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.70);
      color:var(--txt);
      padding:10px 11px;
      border-radius:16px;
      font-weight:900;
      display:inline-flex; gap:8px; align-items:center;
      text-decoration:none;
      transition: transform .08s ease, filter .15s ease;
    }
    .btn:active{transform: translateY(1px)}
    .btn.primary{
      background: linear-gradient(135deg, rgba(217,70,239,.92), rgba(251,113,133,.85));
      color:white;
    }
    .btn.ghost{
      background: rgba(255,255,255,.55);
      color: rgba(42,15,34,.85);
    }
    .btn.small{padding:8px 10px; border-radius:14px; font-size:12px}

    /* Layout */
    .grid{display:grid; grid-template-columns: 360px 1fr; gap:12px; align-items:start;}
    @media (max-width: 980px){ .grid{grid-template-columns: 1fr;} }

    .panel{
      border:1px solid var(--stroke);
      border-radius: var(--r2);
      background: rgba(255,255,255,.72);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .ph{
      padding:14px 14px;
      border-bottom:1px solid var(--stroke);
      background:
        radial-gradient(900px 260px at 10% 0%, rgba(217,70,239,.10), transparent 55%),
        linear-gradient(180deg, rgba(255,255,255,.70), rgba(255,255,255,.50));
    }
    .ph h2{margin:0;font-size:14px}
    .ph p{margin:6px 0 0;color:var(--muted);font-size:12px;line-height:1.45}

    .search{
      width:100%;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.70);
      color:var(--txt);
      border-radius:16px;
      padding:10px 12px;
      outline:none;
      margin:10px 0 10px;
    }

    .progress{
      display:flex; gap:10px; align-items:center; width:100%;
      margin-top:10px;
    }
    .bar{flex:1;height:12px;border-radius:999px;border:1px solid var(--stroke);background:rgba(255,255,255,.65);overflow:hidden}
    .fill{height:100%; width:0%; background: linear-gradient(90deg, rgba(34,197,94,.86), rgba(6,182,212,.72), rgba(217,70,239,.78)); transition: width .25s ease}
    .score{
      font-family:var(--mono); font-size:11px; color:rgba(42,15,34,.70);
      padding:6px 10px; border:1px solid var(--stroke); border-radius:999px; background:rgba(255,255,255,.70)
    }

    .pb{padding:12px}

    .seg{
      width:100%;
      text-align:left;
      border:1px solid transparent;
      background: rgba(255,255,255,.60);
      color:var(--txt);
      padding:10px 10px;
      border-radius:16px;
      cursor:pointer;
      display:flex; gap:10px; align-items:flex-start;
      transition: background .12s ease, border-color .12s ease, transform .08s ease;
      margin-bottom:8px;
    }
    .seg:hover{background: rgba(255,255,255,.80); border-color: rgba(79,12,55,.12)}
    .seg:active{transform: translateY(1px)}
    .seg.active{
      background:
        radial-gradient(900px 240px at 10% 0%, rgba(217,70,239,.12), transparent 55%),
        rgba(255,255,255,.82);
      border-color: rgba(79,12,55,.14);
    }
    .seg .ic{font-size:18px; line-height:1.1; margin-top:1px}
    .seg .meta{flex:1}
    .seg .meta b{display:block; font-size:13px}
    .seg .meta span{display:block; margin-top:2px; color:var(--muted); font-size:12px; line-height:1.35}
    .seg .done{
      width:18px;height:18px;border-radius:7px;
      border:1px solid rgba(79,12,55,.14);
      display:grid; place-items:center;
      margin-top:2px;
      color: rgba(42,15,34,.8);
      background: rgba(255,255,255,.70);
    }
    .seg.completed .done{
      background: rgba(34,197,94,.18);
      border-color: rgba(34,197,94,.45);
      color: rgba(18, 80, 46, .9);
    }

    /* Right */
    .rh{
      padding:14px 16px;
      border-bottom:1px solid var(--stroke);
      background:
        radial-gradient(900px 260px at 90% 0%, rgba(6,182,212,.12), transparent 55%),
        linear-gradient(180deg, rgba(255,255,255,.70), rgba(255,255,255,.50));
      display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap;
    }
    .crumb{
      display:inline-flex; align-items:center; gap:8px;
      padding:6px 10px;
      border:1px solid var(--stroke);
      border-radius:999px;
      background: rgba(255,255,255,.70);
      color:rgba(42,15,34,.72);
      font-size:12px;
    }
    .rh h2{margin:0;font-size:16px}
    .rh p{margin:4px 0 0; color:var(--muted); font-size:12px; line-height:1.45}

    .right-actions{display:flex; gap:8px; flex-wrap:wrap; align-items:center}

    .rb{padding:16px 16px 22px}
    .lessonBox{
      border:1px solid var(--stroke);
      border-radius:18px;
      background: rgba(255,255,255,.70);
      overflow:hidden;
    }
    .lessonHeader{
      padding:12px 12px;
      border-bottom:1px solid var(--stroke);
      display:flex; gap:8px; flex-wrap:wrap; align-items:center; justify-content:space-between;
      background: rgba(255,255,255,.55);
    }
    .lessonHeader .mini{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
    .tag{
      display:inline-flex; align-items:center; gap:6px;
      padding:7px 9px;
      border-radius:999px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.70);
      font-size:12px;
      color: rgba(42,15,34,.75);
    }

    .content{
      padding:14px 14px;
      line-height:1.7;
      color: rgba(42,15,34,.94);
    }
    .content h3{margin: 10px 0 6px; font-size:15px}
    .content h4{margin: 12px 0 6px; font-size:14px}
    .content p{margin: 8px 0; color: rgba(42,15,34,.92)}
    .content ul{margin: 8px 0 8px 18px}
    .content li{margin: 6px 0; color: rgba(42,15,34,.88)}
    .content blockquote{
      margin: 10px 0;
      padding: 10px 12px;
      border-left: 3px solid rgba(251,113,133,.65);
      background: rgba(251,113,133,.08);
      border-radius: 16px;
      color: rgba(42,15,34,.92);
    }
    .callout{
      margin: 10px 0;
      padding: 12px 12px;
      border: 1px solid rgba(79,12,55,.12);
      background:
        radial-gradient(700px 160px at 20% 0%, rgba(34,197,94,.10), transparent 55%),
        rgba(255,255,255,.55);
      border-radius: 18px;
    }
    .callout b{display:block; margin-bottom:6px}
    .grid2{display:grid; grid-template-columns:1fr 1fr; gap:10px}
    @media (max-width: 980px){ .grid2{grid-template-columns:1fr} }

    .art{
      margin: 10px 0;
      border:1px dashed rgba(79,12,55,.18);
      border-radius:18px;
      background: rgba(255,255,255,.65);
      padding:10px;
      overflow:hidden;
    }

    /* Checklist and notes */
    .below{
      margin-top:12px;
      display:grid; grid-template-columns: 1fr 1fr; gap:12px;
    }
    @media (max-width: 980px){ .below{grid-template-columns:1fr} }

    .box{
      border:1px solid var(--stroke);
      border-radius:18px;
      background: rgba(255,255,255,.72);
      padding:12px;
    }
    .box h3{margin:0 0 8px;font-size:14px}
    .row{
      display:flex; gap:10px; align-items:flex-start;
      padding:10px;
      border-radius:14px;
      border:1px solid rgba(79,12,55,.12);
      background: rgba(255,255,255,.55);
      margin-bottom:8px;
    }
    .row input{margin-top:2px; transform: scale(1.15); accent-color: var(--green)}
    .row label{cursor:pointer}
    .row small{display:block; margin-top:2px; color: var(--muted); line-height:1.45}

    textarea{
      width:100%;
      min-height:180px;
      resize:vertical;
      border-radius:16px;
      border:1px solid rgba(79,12,55,.14);
      padding:10px 12px;
      outline:none;
      background: rgba(255,255,255,.75);
      color: var(--txt);
      line-height:1.6;
    }

    /* bottom tabs (app style) */
    .appTabs{
      position:fixed; left:0; right:0; bottom:0;
      padding:10px 10px calc(10px + env(safe-area-inset-bottom));
      background: linear-gradient(180deg, rgba(255,246,251,.05), rgba(255,246,251,.92));
      border-top:1px solid var(--stroke);
      backdrop-filter: blur(12px);
      z-index:60;
    }
    .rail{max-width:1100px;margin:0 auto; display:flex; gap:8px;}
    .appTab{
      flex:1;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.70);
      color: rgba(42,15,34,.75);
      padding:11px 10px;
      border-radius:18px;
      font-weight:1000;
      text-decoration:none;
      display:flex; justify-content:center; align-items:center; gap:8px;
    }
    .appTab.primary{
      background: linear-gradient(135deg, rgba(217,70,239,.92), rgba(251,113,133,.85));
      color:white;
    }

    .toast{
      position:fixed; left:50%;
      bottom:calc(84px + env(safe-area-inset-bottom));
      transform:translateX(-50%) translateY(8px);
      padding:10px 12px;
      border:1px solid rgba(79,12,55,.16);
      border-radius:16px;
      background: rgba(255,255,255,.92);
      color: rgba(42,15,34,.92);
      font-weight:1000;
      font-size:13px;
      box-shadow: 0 20px 70px rgba(80,10,55,.15);
      opacity:0; pointer-events:none;
      transition: opacity .18s ease, transform .18s ease;
      z-index:90;
    }
    .toast.show{opacity:1; transform:translateX(-50%) translateY(0px)}
  </style>
</head>

<body>
  <header class="top">
    <div class="topin">
      <div class="brand">
        <div class="logo">üß†</div>
        <div class="titlebox">
          <h1>M√≥dulo 1 ‚Äî Teoria (8h) ‚Ä¢ Guardi√£s da Vigil√¢ncia</h1>
          <p>Conte√∫do completo para alunas ‚Ä¢ aulas em bot√µes ‚Ä¢ miss√µes ‚Ä¢ mini-quizzes ‚Ä¢ checklist + notas</p>
        </div>
      </div>
      <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
        <span class="pill">‚ú® Protagonismo feminino na ci√™ncia</span>
        <button class="btn small ghost" id="reset">üßº Reset progresso</button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <div class="grid">
      <!-- LEFT: aulas -->
      <aside class="panel">
        <div class="ph">
          <h2>üìö Aulas do M√≥dulo Teoria</h2>
          <p>Escolha uma aula. Voc√™ vai ver explica√ß√µes, exemplos, miss√µes e um mini-quiz.</p>

          <input class="search" id="search" placeholder="üîé Buscar (SUS, Aedes, arboviroses, vigil√¢ncia, CDC‚Ä¶)"/>

          <div class="progress">
            <div class="bar"><div class="fill" id="fill"></div></div>
            <div class="score" id="score">0/0</div>
          </div>
        </div>
        <div class="pb" id="parts"></div>
      </aside>

      <!-- RIGHT: conte√∫do -->
      <section class="panel">
        <div class="rh">
          <div>
            <span class="crumb" id="crumb">üß† Teoria ‚Ä¢ Bem-vindas</span>
            <h2 id="title">Escolha uma aula ‚ú®</h2>
            <p id="subtitle">Voc√™ vai aprender a pensar como vigil√¢ncia: territ√≥rio ‚Üí risco ‚Üí dado ‚Üí decis√£o.</p>
          </div>

          <div class="right-actions">
            <button class="btn primary" id="markDone">‚úÖ Marcar aula como conclu√≠da</button>
            <button class="btn" id="saveNotes">üíæ Salvar notas</button>
          </div>
        </div>

        <div class="rb">
          <div class="lessonBox">
            <div class="lessonHeader">
              <div class="mini">
                <span class="tag" id="tagTime">‚è±Ô∏è 8h</span>
                <span class="tag" id="tagLevel">üéì N√≠vel: jovem cientista</span>
                <span class="tag" id="tagGoal">üéØ Miss√£o: proteger vidas</span>
              </div>
              <span class="tag" id="tagStatus">üìå Aberta</span>
            </div>

            <div class="content" id="content">
              <div class="callout">
                <b>Como usar</b>
                <ul>
                  <li>Abra uma aula no menu √† esquerda.</li>
                  <li>Fa√ßa as <b>miss√µes</b> e responda o <b>mini-quiz</b>.</li>
                  <li>Marque o checklist e registre suas <b>notas pessoais</b>.</li>
                </ul>
              </div>

              <div class="art">
                <svg viewBox="0 0 520 220" width="100%" height="auto" role="img" aria-label="Ilustra√ß√£o: territ√≥rio, vetor e cuidado">
                  <defs>
                    <linearGradient id="gA" x1="0" x2="1">
                      <stop offset="0" stop-color="#d946ef" stop-opacity=".9"/>
                      <stop offset="1" stop-color="#fb7185" stop-opacity=".85"/>
                    </linearGradient>
                    <linearGradient id="gB" x1="0" x2="1">
                      <stop offset="0" stop-color="#06b6d4" stop-opacity=".55"/>
                      <stop offset="1" stop-color="#8b5cf6" stop-opacity=".55"/>
                    </linearGradient>
                  </defs>
                  <rect x="10" y="10" width="500" height="200" rx="26" fill="white" opacity=".9" stroke="rgba(79,12,55,.16)"/>
                  <circle cx="110" cy="80" r="60" fill="url(#gA)" opacity=".20"/>
                  <circle cx="405" cy="70" r="70" fill="url(#gB)" opacity=".18"/>
                  <!-- cidade -->
                  <rect x="70" y="120" width="120" height="70" rx="16" fill="rgba(251,113,133,.10)" stroke="rgba(251,113,133,.35)"/>
                  <rect x="90" y="140" width="26" height="50" rx="8" fill="rgba(217,70,239,.16)"/>
                  <rect x="122" y="132" width="26" height="58" rx="8" fill="rgba(6,182,212,.12)"/>
                  <rect x="154" y="150" width="26" height="40" rx="8" fill="rgba(245,158,11,.12)"/>
                  <!-- mosquito -->
                  <circle cx="292" cy="108" r="10" fill="rgba(42,15,34,.25)"/>
                  <path d="M292 108 L320 90" stroke="rgba(42,15,34,.25)" stroke-width="4" stroke-linecap="round"/>
                  <path d="M292 108 L320 126" stroke="rgba(42,15,34,.25)" stroke-width="4" stroke-linecap="round"/>
                  <path d="M286 98 C270 80, 250 92, 265 110 C250 120, 270 138, 286 120"
                        fill="url(#gA)" opacity=".65"/>
                  <path d="M298 98 C314 80, 334 92, 319 110 C334 120, 314 138, 298 120"
                        fill="url(#gB)" opacity=".55"/>
                  <!-- setas -->
                  <path d="M210 170 C250 150, 285 170, 320 150" fill="none" stroke="rgba(217,70,239,.55)" stroke-width="5" stroke-linecap="round"/>
                  <text x="205" y="206" font-family="system-ui" font-size="14" fill="rgba(42,15,34,.75)">
                    territ√≥rio ‚Üí risco ‚Üí dado ‚Üí decis√£o
                  </text>
                </svg>
              </div>
            </div>
          </div>

          <div class="below">
            <div class="box">
              <h3>‚òëÔ∏è Checklist da aula</h3>
              <div id="checks"></div>
            </div>

            <div class="box">
              <h3>üìù Minhas notas (pessoais)</h3>
              <textarea id="notes" placeholder="Escreva aqui: o que aprendi, d√∫vidas, exemplos do meu bairro, ideias de a√ß√µes‚Ä¶"></textarea>
              <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap;">
                <button class="btn small primary" id="saveNotes2">üíæ Salvar notas</button>
                <button class="btn small" id="clearNotes">üóëÔ∏è Limpar notas desta aula</button>
              </div>
              <p style="margin:10px 0 0; color:var(--muted); font-size:12px;">
                Dica: escreva <b>1 a√ß√£o</b> que voc√™ faria na sua rua para reduzir risco de arboviroses.
              </p>
            </div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <!-- bottom app tabs -->
  <nav class="appTabs">
    <div class="rail">
      <a class="appTab" href="index.html">üè† In√≠cio</a>
      <a class="appTab primary" href="teoria.html">üß† Teoria</a>
      <a class="appTab" href="campo.html">üå± Campo</a>
      <a class="appTab" href="laboratorio.html">üî¨ Lab</a>
      <a class="appTab" href="roteiro-professor.html">üë©‚Äçüè´ Prof</a>
    </div>
  </nav>

  <div class="toast" id="toast">Salvo!</div>

  <script>
    // ==================== Storage ====================
    const LS = {
      done: "gdv_teoria_done_v1",
      checks: "gdv_teoria_checks_v1",
      notes: "gdv_teoria_notes_v1",
      open: "gdv_teoria_open_v1"
    };
    const $ = (s, r=document)=>r.querySelector(s);
    const $$ = (s, r=document)=>Array.from(r.querySelectorAll(s));
    function readJSON(key, fallback){
      try{ const v=localStorage.getItem(key); return v?JSON.parse(v):fallback; }catch(e){ return fallback; }
    }
    function writeJSON(key,val){ localStorage.setItem(key, JSON.stringify(val)); }

    const toastEl = $("#toast");
    let toastTimer=null;
    function toast(msg){
      toastEl.textContent = msg;
      toastEl.classList.add("show");
      clearTimeout(toastTimer);
      toastTimer=setTimeout(()=>toastEl.classList.remove("show"), 1400);
    }

    // ==================== Conte√∫do do M√≥dulo 1 ‚Äî TEORIA ====================
    // Conte√∫do para ALUNAS (forma√ß√£o). O "roteiro professor" fica em outra p√°gina.
    const LESSONS = [
      {
        id:"A1",
        icon:"ü©∫",
        title:"Aula 1 ‚Äî SUS: sa√∫de √© cuidado do territ√≥rio",
        subtitle:"Entender SUS como preven√ß√£o + prote√ß√£o + vigil√¢ncia (al√©m do hospital).",
        crumb:"üß† Teoria ‚Ä¢ SUS",
        duration:"‚è±Ô∏è 1h30‚Äì2h",
        level:"üéì N√≠vel: base",
        goal:"üéØ Miss√£o: enxergar sa√∫de no bairro",
        tags:["SUS","territ√≥rio","preven√ß√£o"],
        html: `
          <h3>O que voc√™ precisa saber (sem decoreba)</h3>
          <p>
            O <b>SUS</b> n√£o √© ‚Äús√≥ hospital‚Äù. O SUS √© um sistema que:
            <b>cuida</b> (atende), <b>protege</b> (previne) e <b>vigia</b> (observa riscos no territ√≥rio).
          </p>

          <div class="callout">
            <b>Ideia-chave</b>
            <p><b>Sa√∫de</b> n√£o nasce s√≥ dentro do posto. Ela nasce tamb√©m no <b>ambiente</b> em que a gente vive.</p>
          </div>

          <h3>Mapa mental (bem simples)</h3>
          <ul>
            <li><b>Aten√ß√£o √† sa√∫de</b>: consultas, vacinas, acompanhamento.</li>
            <li><b>Promo√ß√£o da sa√∫de</b>: h√°bitos, educa√ß√£o, espa√ßos saud√°veis.</li>
            <li><b>Vigil√¢ncia em sa√∫de</b>: observar riscos e agir antes da doen√ßa explodir.</li>
          </ul>

          <div class="art">
            <svg viewBox="0 0 560 210" width="100%" height="auto" role="img" aria-label="Ilustra√ß√£o: SUS em 3 verbos">
              <defs>
                <linearGradient id="susG" x1="0" x2="1">
                  <stop offset="0" stop-color="#d946ef" stop-opacity=".9"/>
                  <stop offset="1" stop-color="#fb7185" stop-opacity=".85"/>
                </linearGradient>
              </defs>
              <rect x="10" y="10" width="540" height="190" rx="26" fill="white" opacity=".92" stroke="rgba(79,12,55,.16)"/>
              <circle cx="120" cy="105" r="60" fill="url(#susG)" opacity=".16"/>
              <circle cx="280" cy="105" r="60" fill="rgba(6,182,212,.16)"/>
              <circle cx="440" cy="105" r="60" fill="rgba(245,158,11,.16)"/>
              <text x="86" y="95" font-size="18" font-family="system-ui" fill="rgba(42,15,34,.85)">Cuidar</text>
              <text x="75" y="120" font-size="13" font-family="system-ui" fill="rgba(42,15,34,.70)">aten√ß√£o</text>

              <text x="250" y="95" font-size="18" font-family="system-ui" fill="rgba(42,15,34,.85)">Proteger</text>
              <text x="246" y="120" font-size="13" font-family="system-ui" fill="rgba(42,15,34,.70)">prevenir</text>

              <text x="410" y="95" font-size="18" font-family="system-ui" fill="rgba(42,15,34,.85)">Vigiar</text>
              <text x="402" y="120" font-size="13" font-family="system-ui" fill="rgba(42,15,34,.70)">riscos</text>

              <path d="M180 105 L220 105" stroke="rgba(42,15,34,.25)" stroke-width="5" stroke-linecap="round"/>
              <path d="M340 105 L380 105" stroke="rgba(42,15,34,.25)" stroke-width="5" stroke-linecap="round"/>
            </svg>
          </div>

          <h3>Miss√£o da aula</h3>
          <div class="callout">
            <b>MISS√ÉO 1 ‚Äî ‚ÄúSa√∫de do meu territ√≥rio‚Äù</b>
            <ul>
              <li>Escreva 3 coisas da sua rua/bairro que <b>protegem</b> a sa√∫de.</li>
              <li>Escreva 3 coisas da sua rua/bairro que <b>aumentam risco</b> de doen√ßas.</li>
              <li>Para cada risco, pense em <b>1 a√ß√£o simples</b> que reduziria o problema.</li>
            </ul>
          </div>

          <h3>Mini-quiz (responda em grupo)</h3>
          <ol>
            <li>Verdadeiro ou falso: ‚ÄúSUS √© s√≥ hospital‚Äù.</li>
            <li>O que significa ‚Äúvigiar riscos‚Äù no territ√≥rio?</li>
            <li>D√™ um exemplo de prote√ß√£o e um de risco no seu bairro.</li>
          </ol>

          <h3>Links (oficiais e confi√°veis)</h3>
          <ul>
            <li><a href="https://www.gov.br/saude/pt-br" target="_blank" rel="noopener">Minist√©rio da Sa√∫de ‚Äî Portal</a></li>
            <li><a href="https://bvsms.saude.gov.br/" target="_blank" rel="noopener">BVS/MS ‚Äî Biblioteca Virtual em Sa√∫de</a></li>
            <li><a href="https://bvsms.saude.gov.br/bvs/publicacoes/guia_vigilancia_saude_5ed_rev_atual.pdf" target="_blank" rel="noopener">Guia de Vigil√¢ncia em Sa√∫de (PDF)</a></li>
          </ul>
        `,
        checklist:[
          {id:"A1C1", label:"Entendi SUS como cuidar + proteger + vigiar", note:"Consigo explicar com minhas palavras."},
          {id:"A1C2", label:"Completei a MISS√ÉO 1", note:"3 prote√ß√µes + 3 riscos + 3 a√ß√µes."},
          {id:"A1C3", label:"Participei do mini-quiz", note:"Respondi com minha equipe."}
        ]
      },

      {
        id:"A2",
        icon:"ü¶†",
        title:"Aula 2 ‚Äî Arboviroses sem terror: impacto e vida real",
        subtitle:"Dengue, chikungunya, zika, oropouche e febre amarela: o que muda na cidade?",
        crumb:"üß† Teoria ‚Ä¢ Arboviroses",
        duration:"‚è±Ô∏è 1h30‚Äì2h",
        level:"üéì N√≠vel: base",
        goal:"üéØ Miss√£o: ligar doen√ßa ao ambiente",
        tags:["dengue","chikungunya","zika","oropouche","febre amarela"],
        html: `
          <h3>Tradu√ß√£o simples</h3>
          <p>
            <b>Arboviroses</b> s√£o doen√ßas causadas por v√≠rus que podem ser transmitidos por
            <b>vetores</b> (ex.: mosquitos). Aqui voc√™ n√£o vai decorar nomes dif√≠ceis: vai entender
            <b>por que ambientes urbanos podem favorecer surtos</b>.
          </p>

          <div class="callout">
            <b>O que realmente importa</b>
            <ul>
              <li><b>Onde o vetor encontra √°gua/abrigo?</b></li>
              <li><b>Quando o clima ajuda?</b> (chuva + calor)</li>
              <li><b>Como o territ√≥rio organiza riscos?</b> (lixo, armazenamento de √°gua, sombra, recipientes)</li>
            </ul>
          </div>

          <h3>Impacto na sa√∫de humana (bem direto)</h3>
          <div class="grid2">
            <div class="callout">
              <b>ü¶ü Dengue</b>
              <p>Febre alta, dor no corpo, pode evoluir para gravidade. Preven√ß√£o depende muito de eliminar criadouros do <b>Aedes</b>.</p>
            </div>
            <div class="callout">
              <b>ü¶ü Chikungunya</b>
              <p>Dor articular forte; pode durar semanas/meses. Mesmo vetor urbano pode estar envolvido.</p>
            </div>
            <div class="callout">
              <b>ü¶ü Zika</b>
              <p>Geralmente quadro mais leve, mas exige aten√ß√£o especial em gestantes e vigil√¢ncia rigorosa.</p>
            </div>
            <div class="callout">
              <b>ü¶ü Oropouche</b>
              <p>Febre e dores; exige vigil√¢ncia e investiga√ß√£o de vetores e ambientes envolvidos.</p>
            </div>
          </div>

          <div class="callout">
            <b>üü° Febre amarela</b>
            <p>O controle envolve vigil√¢ncia, alertas e <b>vacina√ß√£o</b> quando indicada pelas autoridades de sa√∫de.</p>
          </div>

          <div class="art">
            <svg viewBox="0 0 560 230" width="100%" height="auto" role="img" aria-label="Ilustra√ß√£o: cidade e ciclo do risco">
              <rect x="10" y="10" width="540" height="210" rx="26" fill="white" opacity=".92" stroke="rgba(79,12,55,.16)"/>
              <text x="26" y="46" font-size="16" font-family="system-ui" fill="rgba(42,15,34,.80)">Cidade + recipientes + calor ‚Üí mais vetor ‚Üí mais risco</text>

              <rect x="26" y="70" width="160" height="120" rx="18" fill="rgba(251,113,133,.10)" stroke="rgba(251,113,133,.35)"/>
              <text x="44" y="100" font-size="14" font-family="system-ui" fill="rgba(42,15,34,.75)">Recipientes</text>
              <text x="44" y="125" font-size="12" font-family="system-ui" fill="rgba(42,15,34,.60)">pneu ‚Ä¢ pote</text>
              <text x="44" y="145" font-size="12" font-family="system-ui" fill="rgba(42,15,34,.60)">calha ‚Ä¢ balde</text>

              <rect x="204" y="70" width="160" height="120" rx="18" fill="rgba(245,158,11,.10)" stroke="rgba(245,158,11,.35)"/>
              <text x="222" y="100" font-size="14" font-family="system-ui" fill="rgba(42,15,34,.75)">Clima</text>
              <text x="222" y="125" font-size="12" font-family="system-ui" fill="rgba(42,15,34,.60)">chuva + calor</text>

              <rect x="382" y="70" width="142" height="120" rx="18" fill="rgba(6,182,212,.10)" stroke="rgba(6,182,212,.35)"/>
              <text x="400" y="100" font-size="14" font-family="system-ui" fill="rgba(42,15,34,.75)">Vetor</text>
              <text x="400" y="125" font-size="12" font-family="system-ui" fill="rgba(42,15,34,.60)">Aedes</text>

              <path d="M186 130 L204 130" stroke="rgba(42,15,34,.25)" stroke-width="5" stroke-linecap="round"/>
              <path d="M364 130 L382 130" stroke="rgba(42,15,34,.25)" stroke-width="5" stroke-linecap="round"/>

              <circle cx="482" cy="160" r="10" fill="rgba(42,15,34,.25)"/>
              <path d="M482 160 L506 146" stroke="rgba(42,15,34,.25)" stroke-width="4" stroke-linecap="round"/>
              <path d="M482 160 L506 174" stroke="rgba(42,15,34,.25)" stroke-width="4" stroke-linecap="round"/>

              <text x="26" y="210" font-size="12" font-family="system-ui" fill="rgba(42,15,34,.60)">Vigil√¢ncia e controle = cortar o ciclo no territ√≥rio.</text>
            </svg>
          </div>

          <h3>Miss√£o da aula</h3>
          <div class="callout">
            <b>MISS√ÉO 2 ‚Äî ‚ÄúCortar o ciclo‚Äù</b>
            <ul>
              <li>Escolha <b>1 exemplo</b> de recipiente do seu bairro e descreva: onde fica? pega chuva? tem tampa?</li>
              <li>Escreva <b>2 formas</b> de eliminar ou reduzir o risco (sem ‚Äúculpar‚Äù pessoas).</li>
              <li>Crie <b>1 frase educativa</b> curta e respeitosa para a comunidade.</li>
            </ul>
          </div>

          <h3>Mini-quiz</h3>
          <ol>
            <li>Por que calor e chuva podem aumentar o risco?</li>
            <li>Qual √© a melhor forma de reduzir risco urbano do Aedes?</li>
            <li>O que √© ‚Äúmensagem educativa respeitosa‚Äù?</li>
          </ol>

          <h3>Links e cartilhas</h3>
          <ul>
            <li><a href="https://www.gov.br/saude/pt-br/assuntos/saude-de-a-a-z/d/dengue" target="_blank" rel="noopener">MS ‚Äî Dengue</a></li>
            <li><a href="https://www.gov.br/saude/pt-br/assuntos/saude-de-a-a-z/c/chikungunya" target="_blank" rel="noopener">MS ‚Äî Chikungunya</a></li>
            <li><a href="https://www.gov.br/saude/pt-br/assuntos/saude-de-a-a-z/z/zika" target="_blank" rel="noopener">MS ‚Äî Zika</a></li>
            <li><a href="https://www.gov.br/saude/pt-br/assuntos/saude-de-a-a-z/f/febre-amarela" target="_blank" rel="noopener">MS ‚Äî Febre amarela</a></li>
            <li><a href="https://www.ioc.fiocruz.br/sites/default/files/Cartilha_completa_aedes.pdf" target="_blank" rel="noopener">Fiocruz/IOC ‚Äî Cartilha Aedes (PDF)</a></li>
          </ul>
        `,
        checklist:[
          {id:"A2C1", label:"Entendi o ciclo cidade‚Üívetor‚Üírisco", note:"Consigo explicar com exemplo."},
          {id:"A2C2", label:"Completei a MISS√ÉO 2", note:"Recipiente + 2 a√ß√µes + 1 frase."},
          {id:"A2C3", label:"Participei do mini-quiz", note:"Respondi com minha equipe."}
        ]
      },

      {
        id:"A3",
        icon:"ü¶ü",
        title:"Aula 3 ‚Äî Vetores e ciclos de vida: o m√©todo depende do ciclo",
        subtitle:"Aqu√°tico, terrestre, domiciliar: como cada um √© encontrado.",
        crumb:"üß† Teoria ‚Ä¢ Vetores",
        duration:"‚è±Ô∏è 1h30‚Äì2h",
        level:"üéì N√≠vel: intermedi√°rio",
        goal:"üéØ Miss√£o: escolher t√©cnica certa",
        tags:["ciclo","larva","adulto","domic√≠lio"],
        html: `
          <h3>Ideia-chave</h3>
          <blockquote><b>‚ÄúO ciclo de vida manda na t√©cnica.‚Äù</b> Onde o vetor vive define como a gente encontra ele.</blockquote>

          <h3>Tr√™s categorias (bem did√°tico)</h3>
          <div class="grid2">
            <div class="callout">
              <b>ü´ß Aqu√°tico</b>
              <p>Fases na √°gua (ex.: larvas e pupas de mosquito). A observa√ß√£o se concentra em recipientes e √°guas paradas.</p>
            </div>
            <div class="callout">
              <b>ü¶ã Voador (adulto)</b>
              <p>Insetos que voam podem ser amostrados com armadilhas (ex.: CDC em contextos espec√≠ficos) e outras t√©cnicas.</p>
            </div>
            <div class="callout">
              <b>üè† Domiciliar / peridomiciliar</b>
              <p>Insetos que se abrigam em casas, quintais e frestas exigem inspe√ß√£o orientada e vigil√¢ncia espec√≠fica.</p>
            </div>
            <div class="callout">
              <b>üåø Terrestre / sombra</b>
              <p>Alguns vetores preferem mat√©ria org√¢nica, sombra e ambientes √∫midos no peridomic√≠lio.</p>
            </div>
          </div>

          <div class="art">
            <svg viewBox="0 0 560 230" width="100%" height="auto" role="img" aria-label="Ilustra√ß√£o: ciclo de vida e t√©cnica">
              <rect x="10" y="10" width="540" height="210" rx="26" fill="white" opacity=".92" stroke="rgba(79,12,55,.16)"/>
              <text x="26" y="46" font-size="16" font-family="system-ui" fill="rgba(42,15,34,.80)">Ciclo ‚Üí Lugar ‚Üí T√©cnica</text>

              <rect x="26" y="70" width="160" height="120" rx="18" fill="rgba(6,182,212,.10)" stroke="rgba(6,182,212,.35)"/>
              <text x="44" y="100" font-size="14" font-family="system-ui" fill="rgba(42,15,34,.75)">ü´ß Aqu√°tico</text>
              <text x="44" y="125" font-size="12" font-family="system-ui" fill="rgba(42,15,34,.60)">√°gua parada</text>
              <text x="44" y="145" font-size="12" font-family="system-ui" fill="rgba(42,15,34,.60)">recipientes</text>

              <rect x="204" y="70" width="160" height="120" rx="18" fill="rgba(217,70,239,.10)" stroke="rgba(217,70,239,.35)"/>
              <text x="222" y="100" font-size="14" font-family="system-ui" fill="rgba(42,15,34,.75)">ü¶ã Adulto</text>
              <text x="222" y="125" font-size="12" font-family="system-ui" fill="rgba(42,15,34,.60)">voa / atra√ß√£o</text>
              <text x="222" y="145" font-size="12" font-family="system-ui" fill="rgba(42,15,34,.60)">armadilha</text>

              <rect x="382" y="70" width="142" height="120" rx="18" fill="rgba(245,158,11,.10)" stroke="rgba(245,158,11,.35)"/>
              <text x="400" y="100" font-size="14" font-family="system-ui" fill="rgba(42,15,34,.75)">üè† Abrigo</text>
              <text x="400" y="125" font-size="12" font-family="system-ui" fill="rgba(42,15,34,.60)">frestas</text>
              <text x="400" y="145" font-size="12" font-family="system-ui" fill="rgba(42,15,34,.60)">inspe√ß√£o</text>

              <path d="M186 130 L204 130" stroke="rgba(42,15,34,.25)" stroke-width="5" stroke-linecap="round"/>
              <path d="M364 130 L382 130" stroke="rgba(42,15,34,.25)" stroke-width="5" stroke-linecap="round"/>
            </svg>
          </div>

          <h3>Miss√£o da aula</h3>
          <div class="callout">
            <b>MISS√ÉO 3 ‚Äî ‚ÄúQual t√©cnica eu escolheria?‚Äù</b>
            <ul>
              <li>Escreva 1 exemplo de <b>ambiente aqu√°tico</b> urbano (onde pode haver larvas).</li>
              <li>Escreva 1 exemplo de <b>ambiente de abrigo</b> (frestas, ac√∫mulos, peridomic√≠lio).</li>
              <li>Para cada exemplo, escreva: <b>o que eu observaria</b> + <b>que a√ß√£o reduziria risco</b>.</li>
            </ul>
          </div>

          <h3>Mini-quiz</h3>
          <ol>
            <li>Por que ‚Äúuma √∫nica t√©cnica‚Äù n√£o serve para todos os vetores?</li>
            <li>Cite um exemplo de ciclo aqu√°tico e um domiciliar.</li>
          </ol>

          <h3>Links confi√°veis</h3>
          <ul>
            <li><a href="https://www.gov.br/saude/pt-br/assuntos/saude-de-a-a-z/a/aedes-aegypti/vigilancia-entomologica" target="_blank" rel="noopener">MS ‚Äî Vigil√¢ncia entomol√≥gica (Aedes)</a></li>
            <li><a href="https://www.paho.org/en/documents/manual-procedures-leishmaniasis-surveillance-and-control-region-americas-second-ed" target="_blank" rel="noopener">OPAS ‚Äî Manual de leishmaniose (2¬™ ed.)</a></li>
          </ul>
        `,
        checklist:[
          {id:"A3C1", label:"Entendi ‚Äúciclo manda na t√©cnica‚Äù", note:"Dou exemplos de 2 ciclos."},
          {id:"A3C2", label:"Completei a MISS√ÉO 3", note:"2 ambientes + observa√ß√£o + a√ß√£o."},
          {id:"A3C3", label:"Participei do mini-quiz", note:"Respondi com minha equipe."}
        ]
      },

      {
        id:"A4",
        icon:"ü™§",
        title:"Aula 4 ‚Äî Vigil√¢ncia entomol√≥gica: do dado √† decis√£o",
        subtitle:"Armadilhas, inspe√ß√£o, √≠ndices e como isso vira a√ß√£o (controle de arboviroses).",
        crumb:"üß† Teoria ‚Ä¢ Vigil√¢ncia",
        duration:"‚è±Ô∏è 2h",
        level:"üéì N√≠vel: avan√ßando",
        goal:"üéØ Miss√£o: transformar achado em a√ß√£o",
        tags:["armadilha","CDC","dados","decis√£o"],
        html: `
          <h3>O que √© vigil√¢ncia entomol√≥gica?</h3>
          <p>
            √â o conjunto de a√ß√µes para <b>monitorar vetores</b> (presen√ßa, abund√¢ncia, local e tempo)
            e transformar isso em <b>decis√£o</b> de controle.
          </p>

          <div class="callout">
            <b>O que uma vigil√¢ncia boa faz</b>
            <ul>
              <li>Encontra <b>onde</b> est√° o risco</li>
              <li>Entende <b>quando</b> aumenta</li>
              <li>Ajuda a escolher <b>que a√ß√£o</b> √© mais urgente</li>
            </ul>
          </div>

          <h3>Entendendo a armadilha CDC (com linguagem simples)</h3>
          <div class="grid2">
            <div class="callout">
              <b>ü™§ O que √©?</b>
              <p>Uma armadilha com <b>luz</b> (atrai alguns insetos) e <b>ventoinha</b> (puxa para um coletor).</p>
            </div>
            <div class="callout">
              <b>üéØ Para que serve?</b>
              <p>Para <b>medir</b> (monitorar) presen√ßa e quantidade de insetos em um lugar e hor√°rio.</p>
            </div>
          </div>

          <div class="art">
            <svg viewBox="0 0 560 250" width="100%" height="auto" role="img" aria-label="Ilustra√ß√£o: CDC simplificada">
              <rect x="10" y="10" width="540" height="230" rx="26" fill="white" opacity=".92" stroke="rgba(79,12,55,.16)"/>
              <text x="26" y="46" font-size="16" font-family="system-ui" fill="rgba(42,15,34,.80)">CDC (explica√ß√£o simples)</text>

              <!-- corpo -->
              <rect x="240" y="70" width="80" height="110" rx="18" fill="rgba(217,70,239,.12)" stroke="rgba(217,70,239,.35)"/>
              <!-- luz -->
              <circle cx="280" cy="60" r="18" fill="rgba(245,158,11,.20)" stroke="rgba(245,158,11,.35)"/>
              <text x="256" y="30" font-size="12" font-family="system-ui" fill="rgba(42,15,34,.65)">luz</text>

              <!-- ventoinha -->
              <circle cx="280" cy="120" r="18" fill="rgba(6,182,212,.15)" stroke="rgba(6,182,212,.35)"/>
              <path d="M280 102 L286 120 L280 138 L274 120 Z" fill="rgba(6,182,212,.35)"/>
              <text x="236" y="118" font-size="12" font-family="system-ui" fill="rgba(42,15,34,.65)">ventoinha</text>

              <!-- coletor -->
              <rect x="250" y="176" width="60" height="44" rx="14" fill="rgba(34,197,94,.12)" stroke="rgba(34,197,94,.35)"/>
              <text x="240" y="232" font-size="12" font-family="system-ui" fill="rgba(42,15,34,.65)">coletor</text>

              <!-- setas insetos -->
              <path d="M150 90 C190 90, 210 90, 230 90" fill="none" stroke="rgba(42,15,34,.25)" stroke-width="5" stroke-linecap="round"/>
              <path d="M150 130 C190 130, 210 125, 230 118" fill="none" stroke="rgba(42,15,34,.25)" stroke-width="5" stroke-linecap="round"/>
              <path d="M150 170 C190 170, 210 165, 230 160" fill="none" stroke="rgba(42,15,34,.25)" stroke-width="5" stroke-linecap="round"/>
              <text x="70" y="60" font-size="12" font-family="system-ui" fill="rgba(42,15,34,.60)">insetos ‚Üí</text>
            </svg>
          </div>

          <h3>De ‚Äúachado‚Äù para ‚Äúa√ß√£o‚Äù (o cora√ß√£o da vigil√¢ncia)</h3>
          <div class="callout">
            <b>Modelo pr√°tico</b>
            <ul>
              <li><b>Achado</b>: encontramos muitos recipientes com √°gua em uma √°rea.</li>
              <li><b>Interpreta√ß√£o</b>: alto potencial de criadouros (risco maior).</li>
              <li><b>Decis√£o</b>: priorizar manejo ambiental + orienta√ß√£o + monitoramento.</li>
            </ul>
          </div>

          <h3>Miss√£o final do m√≥dulo te√≥rico</h3>
          <div class="callout">
            <b>MISS√ÉO 4 ‚Äî ‚ÄúPlano das Guardi√£s (1 p√°gina)‚Äù</b>
            <ul>
              <li>1 problema do territ√≥rio</li>
              <li>2 sinais de risco (observ√°veis)</li>
              <li>2 a√ß√µes de preven√ß√£o</li>
              <li>1 mensagem curta para a comunidade</li>
            </ul>
          </div>

          <h3>Mini-quiz</h3>
          <ol>
            <li>Qual a diferen√ßa entre ‚Äúcoletar por curiosidade‚Äù e ‚Äúmonitorar por vigil√¢ncia‚Äù?</li>
            <li>Explique ‚Äúachado ‚Üí interpreta√ß√£o ‚Üí decis√£o‚Äù com exemplo.</li>
          </ol>

          <h3>Links e manuais</h3>
          <ul>
            <li><a href="https://www.gov.br/saude/pt-br/centrais-de-conteudo/publicacoes/svsa/dengue/diretrizes-nacionais-para-prevencao-e-controle-das-arboviroses-urbanas-vigilancia-entomologica-e-controle-vetorial.pdf" target="_blank" rel="noopener">MS ‚Äî Diretrizes nacionais (PDF)</a></li>
            <li><a href="https://www.gov.br/saude/pt-br/centrais-de-conteudo/publicacoes/svsa/dengue/manual_liraa_2013.pdf/view" target="_blank" rel="noopener">MS ‚Äî Manual LIRAa (PDF)</a></li>
          </ul>
        `,
        checklist:[
          {id:"A4C1", label:"Entendi CDC (luz + ventoinha + coletor)", note:"Sei explicar com minhas palavras."},
          {id:"A4C2", label:"Completei a MISS√ÉO 4", note:"Plano 1 p√°gina do grupo."},
          {id:"A4C3", label:"Entendi ‚Äúachado‚Üíinterpreta√ß√£o‚Üídecis√£o‚Äù", note:"Consigo dar exemplo."}
        ]
      }
    ];

    // ==================== State ====================
    let done = readJSON(LS.done, {});
    let checks = readJSON(LS.checks, {});
    let notes = readJSON(LS.notes, {});
    let currentId = readJSON(LS.open, null);

    // ==================== UI refs ====================
    const partsEl = $("#parts");
    const searchEl = $("#search");
    const fillEl = $("#fill");
    const scoreEl = $("#score");
    const crumbEl = $("#crumb");
    const titleEl = $("#title");
    const subtitleEl = $("#subtitle");
    const contentEl = $("#content");
    const checksEl = $("#checks");
    const notesEl = $("#notes");

    const tagTime = $("#tagTime");
    const tagLevel = $("#tagLevel");
    const tagGoal = $("#tagGoal");
    const tagStatus = $("#tagStatus");

    function getLesson(id){ return LESSONS.find(x=>x.id===id) || null; }

    function filteredLessons(){
      const q = (searchEl.value||"").trim().toLowerCase();
      if(!q) return LESSONS;
      return LESSONS.filter(l=>{
        const hay = (l.title+" "+l.subtitle+" "+(l.tags||[]).join(" ")).toLowerCase();
        return hay.includes(q);
      });
    }

    function buildParts(){
      partsEl.innerHTML = "";
      const list = filteredLessons();
      if(list.length===0){
        partsEl.innerHTML = `<div class="callout"><b>Nenhuma aula encontrada</b><p>Tente outro termo.</p></div>`;
        return;
      }
      for(const l of list){
        const b = document.createElement("button");
        b.className = "seg" + (l.id===currentId ? " active":"") + (done[l.id] ? " completed":"");
        b.dataset.id = l.id;
        b.innerHTML = `
          <div class="ic">${l.icon}</div>
          <div class="meta">
            <b>${l.title}</b>
            <span>${l.subtitle}</span>
          </div>
          <div class="done">${done[l.id] ? "‚úì" : ""}</div>
        `;
        b.addEventListener("click", ()=> openLesson(l.id));
        partsEl.appendChild(b);
      }
    }

    function renderChecklist(lesson){
      checksEl.innerHTML = "";
      if(!lesson) return;

      for(const item of lesson.checklist){
        const row = document.createElement("div");
        row.className = "row";
        const cb = document.createElement("input");
        cb.type="checkbox";
        cb.id=item.id;
        cb.checked=!!checks[item.id];
        cb.addEventListener("change", ()=>{
          checks[item.id]=cb.checked;
          writeJSON(LS.checks, checks);
          updateProgress();
        });

        const lab = document.createElement("label");
        lab.htmlFor=item.id;
        lab.innerHTML = `<b>${item.label}</b><small>${item.note||""}</small>`;

        row.appendChild(cb);
        row.appendChild(lab);
        checksEl.appendChild(row);
      }
    }

    function openLesson(id){
      const l = getLesson(id);
      if(!l) return;
      currentId = id;
      writeJSON(LS.open, currentId);

      crumbEl.textContent = l.crumb || "üß† Teoria";
      titleEl.textContent = l.title;
      subtitleEl.textContent = l.subtitle;

      tagTime.textContent = l.duration || "‚è±Ô∏è";
      tagLevel.textContent = l.level || "üéì";
      tagGoal.textContent = l.goal || "üéØ";

      contentEl.innerHTML = l.html;

      renderChecklist(l);

      notesEl.value = notes[id] || "";

      tagStatus.textContent = done[id] ? "‚úÖ Conclu√≠da" : "üìå Aberta";
      $("#markDone").textContent = done[id] ? "‚úÖ Aula j√° conclu√≠da" : "‚úÖ Marcar aula como conclu√≠da";

      buildParts();
      updateProgress();
      toast("üìå Aula aberta!");
    }

    function computeTotals(){
      const totalChecks = LESSONS.reduce((acc,l)=> acc + (l.checklist?.length||0), 0);
      let doneChecks = 0;
      LESSONS.forEach(l => (l.checklist||[]).forEach(c => { if(checks[c.id]) doneChecks++; }));
      return {totalChecks, doneChecks};
    }

    function updateProgress(){
      const {totalChecks, doneChecks} = computeTotals();
      const pct = totalChecks ? Math.round((doneChecks/totalChecks)*100) : 0;
      fillEl.style.width = pct + "%";
      scoreEl.textContent = `${doneChecks}/${totalChecks} ‚Ä¢ ${pct}%`;
    }

    // Events
    searchEl.addEventListener("input", ()=> buildParts());

    function saveNotes(){
      if(!currentId) return toast("Abra uma aula primeiro");
      notes[currentId] = notesEl.value || "";
      writeJSON(LS.notes, notes);
      toast("üíæ Notas salvas!");
    }
    $("#saveNotes").addEventListener("click", saveNotes);
    $("#saveNotes2").addEventListener("click", saveNotes);

    $("#clearNotes").addEventListener("click", ()=>{
      if(!currentId) return;
      if(!confirm("Limpar notas desta aula?")) return;
      notesEl.value = "";
      notes[currentId] = "";
      writeJSON(LS.notes, notes);
      toast("üóëÔ∏è Notas limpas!");
    });

    $("#markDone").addEventListener("click", ()=>{
      if(!currentId) return toast("Abra uma aula primeiro");
      done[currentId] = true;
      writeJSON(LS.done, done);
      tagStatus.textContent = "‚úÖ Conclu√≠da";
      $("#markDone").textContent = "‚úÖ Aula j√° conclu√≠da";
      buildParts();
      toast("üèÅ Aula conclu√≠da!");
    });

    $("#reset").addEventListener("click", ()=>{
      if(!confirm("Resetar progresso e notas deste m√≥dulo (Teoria)?")) return;
      localStorage.removeItem(LS.done);
      localStorage.removeItem(LS.checks);
      localStorage.removeItem(LS.notes);
      localStorage.removeItem(LS.open);
      done={}; checks={}; notes={}; currentId=null;
      searchEl.value="";
      buildParts();
      updateProgress();
      contentEl.innerHTML = `<div class="callout"><b>Reset feito</b><p>Abra uma aula novamente no menu.</p></div>`;
      checksEl.innerHTML = "";
      notesEl.value = "";
      crumbEl.textContent = "üß† Teoria ‚Ä¢ Reset";
      titleEl.textContent = "Escolha uma aula ‚ú®";
      subtitleEl.textContent = "Voc√™ vai aprender a pensar como vigil√¢ncia: territ√≥rio ‚Üí risco ‚Üí dado ‚Üí decis√£o.";
      tagStatus.textContent = "üìå Aberta";
      toast("üßº Reset conclu√≠do");
    });

    // init
    buildParts();
    updateProgress();
    const first = LESSONS[0];
    if(currentId && getLesson(currentId)) openLesson(currentId);
    else if(first) openLesson(first.id);
  </script>
</body>
</html>

